{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Cart - Harvest Farms</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;700;800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --soil: #3a2e24;
            --leaf-dark: #254f32;
            --leaf: #3f7a4f;
            --leaf-soft: #7ea26f;
            --cream: #f5f0e3;
            --text: #2f352f;
            --line: #d8dfd0;
        }

        body {
            margin: 0;
            font-family: "Plus Jakarta Sans", sans-serif;
            color: var(--text);
            background:
                radial-gradient(circle at 90% -10%, rgba(126, 162, 111, 0.2), transparent 35%),
                radial-gradient(circle at 0% 22%, rgba(37, 79, 50, 0.12), transparent 35%),
                var(--cream);
        }

        .cart-wrap {
            padding: 2rem 0 3rem;
        }

        .cart-header {
            border-radius: 1rem;
            background: linear-gradient(140deg, var(--leaf-dark), var(--leaf));
            color: #fff;
            padding: 1.2rem 1.1rem;
            margin-bottom: 1.2rem;
            box-shadow: 0 14px 28px rgba(24, 39, 28, 0.2);
        }

        .cart-shell {
            background: #fff;
            border: 1px solid rgba(37, 79, 50, 0.15);
            border-radius: 1rem;
            overflow: hidden;
            box-shadow: 0 18px 36px rgba(24, 39, 28, 0.12);
        }

        .table thead th {
            background: #eaf2e5;
            color: #2f4535;
            border-bottom: 1px solid #d9e5d3;
        }

        .table td, .table th {
            vertical-align: middle;
        }

        .product-cell {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .thumb {
            width: 58px;
            height: 58px;
            border-radius: 0.55rem;
            object-fit: cover;
            border: 1px solid #d7dfd3;
            background: #f4f7f1;
            flex-shrink: 0;
        }

        .summary-card {
            background: #f8fbf5;
            border: 1px solid #d5e0d2;
            border-radius: 0.85rem;
            padding: 1rem;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #536353;
        }

        .grand-total {
            border-top: 1px dashed #bfd0bf;
            padding-top: 0.6rem;
            margin-top: 0.6rem;
            font-size: 1.15rem;
            font-weight: 800;
            color: var(--leaf-dark);
        }

        .btn-farm {
            border: 0;
            border-radius: 0.72rem;
            padding: 0.72rem 1rem;
            color: #fff;
            font-weight: 700;
            background: linear-gradient(135deg, var(--leaf-dark), var(--leaf));
        }

        .btn-farm:hover {
            color: #fff;
            opacity: 0.96;
        }

        .qty-form {
            display: flex;
            gap: 0.45rem;
            align-items: center;
        }

        .qty-field {
            width: 84px;
        }

        .btn-mini {
            border-radius: 0.6rem;
            padding: 0.45rem 0.7rem;
            font-size: 0.82rem;
            font-weight: 700;
            border: 0;
        }

        .btn-update {
            background: #2f6a43;
            color: #fff;
        }

        .btn-remove {
            background: #b04539;
            color: #fff;
        }
    </style>
</head>
<body>
    {% include 'partials/navbar.html' %}

    <main class="cart-wrap">
        <div class="container">
            <section class="cart-header">
                <h1 class="h3 mb-1">Your Cart</h1>
                <p class="mb-0">Review products, quantities, and total before checkout.</p>
            </section>

            {% if cart_items %}
                <div class="row g-3">
                    <div class="col-lg-8">
                        <section class="cart-shell p-2 p-md-3">
                            <div class="table-responsive">
                                <table class="table mb-0">
                                    <thead>
                                        <tr>
                                            <th>Product</th>
                                            <th>Price</th>
                                            <th>Qty</th>
                                            <th>Line Total</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for item in cart_items %}
                                            <tr>
                                                <td>
                                                    <div class="product-cell">
                                                        {% if item.product.image %}
                                                            <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" class="thumb" onerror="this.onerror=null;this.src='{% static 'core/images/homepicture.jpg' %}';">
                                                        {% else %}
                                                            <img src="{% static 'core/images/homepicture.jpg' %}" alt="No image" class="thumb">
                                                        {% endif %}
                                                        <strong>{{ item.product.name }}</strong>
                                                    </div>
                                                </td>
                                                <td>${{ item.product.price }}</td>
                                                <td>
                                                    <form method="post" action="{% url 'cart:update_cart_quantity' item.product.id %}" class="qty-form">
                                                        {% csrf_token %}
                                                        <input type="number" name="quantity" value="{{ item.quantity }}" min="1" class="form-control form-control-sm qty-field">
                                                        <button type="submit" class="btn-mini btn-update">Update</button>
                                                    </form>
                                                </td>
                                                <td><strong>${{ item.total_price }}</strong></td>
                                                <td>
                                                    <form method="post" action="{% url 'cart:remove_from_cart' item.product.id %}">
                                                        {% csrf_token %}
                                                        <button type="submit" class="btn-mini btn-remove">Remove</button>
                                                    </form>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </section>
                    </div>

                    <div class="col-lg-4">
                        <section class="summary-card">
                            <h2 class="h5 mb-3">Cart Summary</h2>
                            <div class="summary-row">
                                <span>Total Items</span>
                                <span>{{ total_items }}</span>
                            </div>
                            <div class="summary-row grand-total">
                                <span>Total Amount</span>
                                <span>${{ cart_total }}</span>
                            </div>
                            <a href="{% url 'cart:checkout' %}" class="btn btn-farm w-100 mt-3">Proceed to Checkout</a>
                            <a href="{% url 'shop:product_list' %}" class="btn btn-outline-secondary w-100 mt-2">Continue Shopping</a>
                        </section>
                    </div>
                </div>
            {% else %}
                <div class="alert alert-warning text-center" role="alert">
                    Your cart is empty. Add products to see them here.
                </div>
                <div class="text-center">
                    <a href="{% url 'shop:product_list' %}" class="btn btn-farm">Browse Products</a>
                </div>
            {% endif %}
        </div>
    </main>

    {% include 'partials/footer.html' %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
